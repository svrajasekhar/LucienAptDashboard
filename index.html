<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apartment Financial Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f4f6f8}
.container{padding:12px;max-width:900px;margin:auto}
.kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.kpi,.section{background:#fff;padding:12px;border-radius:8px}
.section{margin-top:14px}
ul{padding-left:18px}
</style>
</head>
<body>
<div class="container">
<h2>Society Financial Dashboard</h2>

<div class="kpis">
<div class="kpi"><b>Opening Balance</b><br>₹<span id="opening"></span></div>
<div class="kpi"><b>Closing Balance</b><br>₹<span id="closing"></span></div>
<div class="kpi"><b>Total Revenue</b><br>₹<span id="revenue"></span></div>
<div class="kpi"><b>Total Expense</b><br>₹<span id="expense"></span></div>
</div>

<div class="section"><h3>Defaulters – Current Quarter</h3><ul id="defaulters"></ul></div>
<div class="section"><h3>Revenue Breakdown</h3><canvas id="revChart"></canvas></div>
<div class="section"><h3>Expense Breakdown</h3><canvas id="expChart"></canvas></div>
<div class="section"><h3>News & Issues</h3><ul id="news"></ul></div>
</div>

<script>
const OPENING_BALANCE=109379.56,MAINT_Q=10500;

Promise.all([
fetch("data/transactions.json").then(r=>r.json()),
fetch("data/apartments.json").then(r=>r.json()),
fetch("data/news.json").then(r=>r.json())
]).then(([tx,apts,news])=>{
let revenue=0,expense=0,revMap={},expMap={},paid={};

tx.forEach(t=>{
const raw=t["Amount (₹)"];
if(!raw) return;
const amt=Number(String(raw).replace("₹","").replace(/,/g,""));
if(t.Type==="Revenue"){
revenue+=amt;
revMap[t.Category]=(revMap[t.Category]||0)+amt;
if(t["Sub-Category"]==="Maintenance Fee"){
const a=t["Apt No"];paid[a]=(paid[a]||0)+amt;}
}
if(t.Type==="Expense"){
expense+=amt;
expMap[t.Category]=(expMap[t.Category]||0)+amt;}
});

opening.innerText=OPENING_BALANCE.toFixed(2);
revenueEl=revenue;document.getElementById("revenue").innerText=revenue.toFixed(2);
document.getElementById("expense").innerText=expense.toFixed(2);
document.getElementById("closing").innerText=(OPENING_BALANCE+revenue-expense).toFixed(2);

const d=document.getElementById("defaulters");
apts.forEach(a=>{if((paid[a.apartment]||0)<MAINT_Q){const li=document.createElement("li");li.innerText=a.apartment;d.appendChild(li);}});
if(!d.hasChildNodes())d.innerHTML="<li>No defaulters</li>";

new Chart(document.getElementById("revChart"),{type:"pie",data:{labels:Object.keys(revMap),datasets:[{data:Object.values(revMap)}]}});
new Chart(document.getElementById("expChart"),{type:"pie",data:{labels:Object.keys(expMap),datasets:[{data:Object.values(expMap)}]}});

const n=document.getElementById("news");
news.forEach(x=>{const li=document.createElement("li");li.innerText=`${x.Date} – ${x.Title}`;n.appendChild(li);});
});
</script>
</body>
</html>
