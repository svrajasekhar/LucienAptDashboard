<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lucien Apartment Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f4f6f8}
.container{padding:12px;max-width:1000px;margin:auto}
h2{text-align:center}
.kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
.kpi{background:#fff;padding:12px;border-radius:8px}
.kpi small{display:block;font-size:12px;color:#666;margin-top:4px}
.section{background:#fff;margin-top:16px;padding:12px;border-radius:8px}
.badge{display:inline-block;padding:2px 8px;border-radius:12px;background:#c0392b;color:#fff;font-size:12px;margin-left:6px}
.news-item{margin-bottom:10px}
.news-title{font-weight:bold}
.news-meta{font-size:12px;color:#555}

.kpi.opening { background:#e3f2fd; color:#0d47a1; }
.kpi.closing { background:#e8f5e9; color:#1b5e20; }
.kpi.revenue { background:#f3e5f5; color:#4a148c; }
.kpi.expense { background:#ffebee; color:#b71c1c; }
.kpi.corpus { background:#fffde7; color:#827717; }
.kpi.pending { background:#fff3e0; color:#e65100; }
.kpi b { font-size:14px; }
.kpi span { font-size:20px; font-weight:bold; }


/* Dark mode */
/* Section background differentiation */
.section.defaulters { background:#fce4ec; }
.section.quarterly { background:#e3f2fd; }
.section.revenue { background:#f3e5f5; }
.section.expense { background:#e8f5e9; }
.section.news { background:#fffde7; }


/* Smaller date text in KPIs */
.kpi small { font-size:9px; }


/* Smaller font for date VALUES only (not labels) */
#fromDate, #toDate, #corpusDate {
  font-size: 9px;
  font-weight: bold;
  opacity: 0.9;
}

</style>
</head>
<body>
<div class="container">

<div style="text-align:center;margin-bottom:10px;">
  <img src="assets/lucien_logo.png" alt="Lucien Apartments Logo" style="max-height:80px;">
</div>



<h2>Lucien Apartment Dashboard</h2>

<div class="kpis">
  <div class="kpi opening">
    <b>Opening Balance</b><br>
    ₹<span id="opening">0</span>
    <small>From: <span id="fromDate">-</span></small>
  </div>

  <div class="kpi closing">
    <b>Closing Balance</b><br>
    ₹<span id="closing">0</span>
    <small>As on: <span id="toDate">-</span></small>
  </div>

  <div class="kpi revenue"><b>Total Revenue</b><br>₹<span id="revenue">0</span></div>
  <div class="kpi expense"><b>Total Expense</b><br>₹<span id="expense">0</span></div>

  <div class="kpi corpus">
    <b>Corpus Fund Balance</b><br>
    ₹<span id="corpusAmount">38,00,000</span>
    <small>As on: <span id="corpusDate">31-Dec-2025</span></small>
  </div>

  <div class="kpi pending">
    <b>Pending Collections</b><br>
    ₹<span id="pendingCollections">0</span>
  </div>
</div>

<div class="section defaulters">
  <h3>Defaulters – Current Quarter <span class="badge" id="defaulterCount">0</span></h3>
  <div id="defaulters">-</div>
</div>

<div class="section quarterly">
  <h3>Quarterly: Expense vs Projection</h3>
  <canvas id="qChart"></canvas>
</div>

<div class="section revenue">
  <h3>Revenue Breakdown</h3>
  <canvas id="revChart"></canvas>
</div>

<div class="section expense">
  <h3>Expense Breakdown</h3>
  <canvas id="expChart"></canvas>
</div>

<div class="section news">
  <h3>News & Issues</h3>
  <div id="news"></div>
</div>

<div style="margin-top:16px;font-size:12px;color:#666;text-align:center;">
  Data as on <span id="dataAsOn">-</span>
</div>

</div>

<script>
const OPENING_BALANCE = 109379.56;
const MAINT_Q = 10500;
const MONTHLY_PROJECTION = 262000;
const QUARTERLY_PROJECTION = MONTHLY_PROJECTION * 3;

const QUARTER_LABELS = {
  1: "Jan to March",
  2: "Apr to June",
  3: "Jul to Sept",
  4: "Oct to Dec"
};

function parseDate(d){
  if(!d) return null;
  const parsed = new Date(d);
  return isNaN(parsed) ? null : parsed;
}

function formatDate(d){
  return d.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"-");
}

function getQuarter(m){ return Math.floor(m/3)+1; }

Promise.all([
  fetch("data/transactions.json").then(r=>r.json()),
  fetch("data/apartments.json").then(r=>r.json()),
  fetch("data/news.json").then(r=>r.json())
]).then(([tx,apts,news])=>{

let revenue=0, expense=0;
let revMap={}, expMap={}, paid={}, dates=[], defaulters=[];
let qExpense={};

tx.forEach(t=>{
  const dt=parseDate(t.Date);
  if(dt) dates.push(dt);

  const raw=t["Amount (₹)"];
  if(!raw) return;
  const amt=Number(String(raw).replace("₹","").replace(/,/g,""));
  if(isNaN(amt)) return;

  const type=String(t.Type||"").toLowerCase();
  const sub=String(t["Sub-Category"]||"").toLowerCase();

  if(type==="revenue"){
    revenue+=amt;
    revMap[t.Category]=(revMap[t.Category]||0)+amt;

    if(sub==="maintenance fee"){
      const apt=t.apartment ?? t["Apt No"];
      if(apt!==undefined){
        const k=String(apt).trim();
        paid[k]=(paid[k]||0)+amt;
      }
    }
  }

  if(type==="expense"){
    expense+=amt;
    expMap[t.Category]=(expMap[t.Category]||0)+amt;
    if(dt){
      const qLabel=QUARTER_LABELS[getQuarter(dt.getMonth())];
      qExpense[qLabel]=(qExpense[qLabel]||0)+amt;
    }
  }
});

document.getElementById("opening").innerText=Math.round(OPENING_BALANCE).toLocaleString("en-IN");
document.getElementById("revenue").innerText=Math.round(revenue).toLocaleString("en-IN");
document.getElementById("expense").innerText=Math.round(expense).toLocaleString("en-IN");
document.getElementById("closing").innerText=Math.round(OPENING_BALANCE+revenue-expense).toLocaleString("en-IN");

if(dates.length){
  const minD=new Date(Math.min(...dates));
  const maxD=new Date(Math.max(...dates));
  document.getElementById("fromDate").innerText=formatDate(minD);
  document.getElementById("toDate").innerText=formatDate(maxD);
  document.getElementById("dataAsOn").innerText=formatDate(maxD);
}

apts.forEach(a=>{
  const k=String(a.apartment);
  if((paid[k]||0)<MAINT_Q) defaulters.push(k);
});

document.getElementById("defaulters").innerText=defaulters.length?defaulters.join(", "):"No defaulters";
document.getElementById("defaulterCount").innerText=defaulters.length;

const expected=apts.length*MAINT_Q;
let collected=0; Object.values(paid).forEach(v=>collected+=v);
document.getElementById("pendingCollections").innerText=Math.max(expected-collected,0).toLocaleString("en-IN");

new Chart(document.getElementById("qChart"),{
  type:"bar",
  data:{labels:Object.keys(qExpense),
    datasets:[
      {label:"Actual Expense",data:Object.values(qExpense).map(v=>Math.round(v))},
      {label:"Projected Expense",data:Object.keys(qExpense).map(()=>QUARTERLY_PROJECTION)}
    ]}
});

new Chart(document.getElementById("revChart"),{
  type:"pie",
  data:{labels:Object.keys(revMap),datasets:[{data:Object.values(revMap)}]}
});

new Chart(document.getElementById("expChart"),{
  type:"pie",
  data:{labels:Object.keys(expMap),datasets:[{data:Object.values(expMap)}]}
});

const n=document.getElementById("news");
news.forEach(x=>{
  const d=document.createElement("div");
  d.className="news-item";
  d.innerHTML=`<div class="news-title">${x.Title}</div>
  <div class="news-meta">Date: ${x.Date} | Status: ${x.Status||"N/A"}</div>
  <div>${x.Description||""}</div>`;
  n.appendChild(d);
});



});
</script>
</body>
</html>